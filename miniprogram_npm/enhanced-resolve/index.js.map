{"version":3,"sources":["node.js","ResolverFactory.js","Resolver.js","createInnerCallback.js","SyncAsyncFileSystemDecorator.js","ParsePlugin.js","DescriptionFilePlugin.js","DescriptionFileUtils.js","forEachBail.js","NextPlugin.js","TryNextPlugin.js","ModuleKindPlugin.js","FileKindPlugin.js","JoinRequestPlugin.js","ModulesInHierachicDirectoriesPlugin.js","getPaths.js","ModulesInRootPlugin.js","AliasPlugin.js","AliasFieldPlugin.js","getInnerRequest.js","ConcordExtensionsPlugin.js","concord.js","globToRegExp.js","ConcordMainPlugin.js","ConcordModulesPlugin.js","DirectoryExistsPlugin.js","FileExistsPlugin.js","SymlinkPlugin.js","MainFieldPlugin.js","UseFilePlugin.js","AppendPlugin.js","ResultPlugin.js","ModuleAppendPlugin.js","UnsafeCachePlugin.js","NodeJsInputFileSystem.js","CachedInputFileSystem.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,ADGA;AELA,ADGA,AENA,AHSA;AELA,ADGA,AENA,AHSA;AELA,ADGA,AENA,AHSA;AELA,ADGA,AGTA,ADGA,AHSA;AELA,ADGA,AGTA,ADGA,AHSA;AELA,ADGA,AGTA,ADGA,AHSA;AKdA,AHSA,ADGA,AGTA,ADGA,AHSA;AKdA,AHSA,ADGA,AGTA,ADGA,AHSA;AKdA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ADGA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ADGA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ADGA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AHSA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AFMA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,ADGA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AENA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AIZA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AIZA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AIZA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ADGA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ADGA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ADGA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AFMA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,ALeA,AJYA,AHSA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,ALeA,APqBA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AZoCA,ADGA,AGTA,AMlBA,APqBA,AKfA,ARwBA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AZoCA,ADGA,AGTA,AMlBA,APqBA,AKfA,AOrBA,Af6CA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AZoCA,ADGA,AGTA,AMlBA,APqBA,AKfA,AOrBA,Af6CA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AZoCA,ADGA,AGTA,AMlBA,APqBA,AKfA,AOrBA,Af6CA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AMlBA,APqBA,AKfA,AOrBA,Af6CA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,ADGA,AKfA,AOrBA,Af6CA;AMjBA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,ADGA,AKfA,AOrBA,Af6CA;AiBlDA,AXiCA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AiBlDA,AXiCA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AiBlDA,AXiCA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AKfA,ACHA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AMlBA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AOrBA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AMlBA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AMlBA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AXiCA,ACHA,AMlBA,AFMA,AGTA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AMlBA,ACHA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AIZA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,Af6CA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,Ad0CA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,AjBmDA,ACHA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,AhBgDA,AOrBA,AENA,Ad0CA,ADGA,AGTA,AiBnDA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,AhBgDA,AOrBA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AOrBA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AOrBA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AOrBA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,AXiCA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,AXiCA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,AXiCA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AJYA,AOrBA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,AoB5DA,AbuCA,AWjCA,AGTA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,AoB5DA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AZoCA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,Ad0CA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,Ad0CA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,Ad0CA,AZoCA,ADGA,A0B9EA,ANkBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,Ad0CA,AZoCA,ADGA,A0B9EA,AENA,ARwBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,Ad0CA,AZoCA,ADGA,A0B9EA,AENA,ARwBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AGTA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A0B9EA,AENA,ARwBA,AbuCA,Ac1CA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A0B9EA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A0B9EA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A0B9EA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,A1B8EA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AV8BA,AGTA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,APqBA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AENA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,APqBA,ACHA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,ANkBA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,ANkBA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,A9B0FA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,ANkBA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,ANkBA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,ANkBA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AkBrDA,ADGA,AavCA,AKfA,AXiCA,AjBmDA,AkBtDA,ACHA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AiBlDA,AavCA,AKfA,AXiCA,AjBmDA,AmBzDA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AiBlDA,AavCA,AKfA,AXiCA,AjBmDA,AmBzDA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;AiBlDA,AavCA,AKfA,AXiCA,AjBmDA,AmBzDA,AENA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;A8BzFA,AKfA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;A8BzFA,AKfA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AJYA,ARwBA,ACHA,AtBkEA;A8BzFA,AKfA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A8B1FA,AJYA,AMlBA,AZoCA,ACHA,AtBkEA;A8BzFA,AKfA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,AXiCA,AjBmDA,AqB/DA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,AXiCA,AIZA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,AXiCA,AIZA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,A0B9EA,AMlBA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,AIZA,AENA,AhCgGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,APqBA,A1B8EA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AgChGA,AZoCA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AoB5DA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AoB5DA,ACHA,AtBkEA;AmCxGA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AjCmGA,ADGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AoB5DA,ACHA;AatCA,AlCsGA,AqB/DA;AatCA,AlCsGA,AqB/DA;AatCA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA,AlCsGA;AkCrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar ResolverFactory = require(\"./ResolverFactory\");\r\n\r\nvar NodeJsInputFileSystem = require(\"./NodeJsInputFileSystem\");\r\nvar CachedInputFileSystem = require(\"./CachedInputFileSystem\");\r\n\r\nvar nodeFileSystem = new CachedInputFileSystem(new NodeJsInputFileSystem(), 4000);\r\n\r\nvar nodeContext = {\r\n\tenvironments: [\r\n\t\t\"node+es3+es5+process+native\"\r\n\t]\r\n};\r\n\r\nvar asyncResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports = function resolve(context, path, request, callback) {\r\n\tif(typeof context === \"string\") {\r\n\t\tcallback = request;\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\tasyncResolver.resolve(context, path, request, callback);\r\n};\r\n\r\nvar syncResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tuseSyncFileSystemCalls: true,\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports.sync = function resolveSync(context, path, request) {\r\n\tif(typeof context === \"string\") {\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\treturn syncResolver.resolveSync(context, path, request);\r\n};\r\n\r\nvar asyncContextResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tresolveToContext: true,\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports.context = function resolveContext(context, path, request, callback) {\r\n\tif(typeof context === \"string\") {\r\n\t\tcallback = request;\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\tasyncContextResolver.resolve(context, path, request, callback);\r\n};\r\n\r\nvar syncContextResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tresolveToContext: true,\r\n\tuseSyncFileSystemCalls: true,\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports.context.sync = function resolveContextSync(context, path, request) {\r\n\tif(typeof context === \"string\") {\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\treturn syncContextResolver.resolveSync(context, path, request);\r\n};\r\n\r\nvar asyncLoaderResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tmoduleExtensions: [\"-loader\"],\r\n\tmainFields: [\"loader\", \"main\"],\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports.loader = function resolveLoader(context, path, request, callback) {\r\n\tif(typeof context === \"string\") {\r\n\t\tcallback = request;\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\tasyncLoaderResolver.resolve(context, path, request, callback);\r\n};\r\n\r\nvar syncLoaderResolver = ResolverFactory.createResolver({\r\n\textensions: [\".js\", \".json\", \".node\"],\r\n\tmoduleExtensions: [\"-loader\"],\r\n\tmainFields: [\"loader\", \"main\"],\r\n\tuseSyncFileSystemCalls: true,\r\n\tfileSystem: nodeFileSystem\r\n});\r\nmodule.exports.loader.sync = function resolveLoaderSync(context, path, request) {\r\n\tif(typeof context === \"string\") {\r\n\t\trequest = path;\r\n\t\tpath = context;\r\n\t\tcontext = nodeContext;\r\n\t}\r\n\treturn syncLoaderResolver.resolveSync(context, path, request);\r\n};\r\n\r\nmodule.exports.create = function create(options) {\r\n\toptions = Object.assign({\r\n\t\tfileSystem: nodeFileSystem\r\n\t}, options);\r\n\tvar resolver = ResolverFactory.createResolver(options);\r\n\treturn function(context, path, request, callback) {\r\n\t\tif(typeof context === \"string\") {\r\n\t\t\tcallback = request;\r\n\t\t\trequest = path;\r\n\t\t\tpath = context;\r\n\t\t\tcontext = nodeContext;\r\n\t\t}\r\n\t\tresolver.resolve(context, path, request, callback);\r\n\t};\r\n};\r\n\r\nmodule.exports.create.sync = function createSync(options) {\r\n\toptions = Object.assign({\r\n\t\tuseSyncFileSystemCalls: true,\r\n\t\tfileSystem: nodeFileSystem\r\n\t}, options);\r\n\tvar resolver = ResolverFactory.createResolver(options);\r\n\treturn function(context, path, request) {\r\n\t\tif(typeof context === \"string\") {\r\n\t\t\trequest = path;\r\n\t\t\tpath = context;\r\n\t\t\tcontext = nodeContext;\r\n\t\t}\r\n\t\treturn resolver.resolveSync(context, path, request);\r\n\t};\r\n};\r\n\r\n// Export Resolver, FileSystems and Plugins\r\nmodule.exports.ResolverFactory = ResolverFactory;\r\n\r\nmodule.exports.NodeJsInputFileSystem = NodeJsInputFileSystem;\r\nmodule.exports.CachedInputFileSystem = CachedInputFileSystem;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Resolver = require(\"./Resolver\");\r\n\r\nvar SyncAsyncFileSystemDecorator = require(\"./SyncAsyncFileSystemDecorator\");\r\n\r\nvar ParsePlugin = require(\"./ParsePlugin\");\r\nvar DescriptionFilePlugin = require(\"./DescriptionFilePlugin\");\r\nvar NextPlugin = require(\"./NextPlugin\");\r\nvar TryNextPlugin = require(\"./TryNextPlugin\");\r\nvar ModuleKindPlugin = require(\"./ModuleKindPlugin\");\r\nvar FileKindPlugin = require(\"./FileKindPlugin\");\r\nvar JoinRequestPlugin = require(\"./JoinRequestPlugin\");\r\nvar ModulesInHierachicDirectoriesPlugin = require(\"./ModulesInHierachicDirectoriesPlugin\");\r\nvar ModulesInRootPlugin = require(\"./ModulesInRootPlugin\");\r\nvar AliasPlugin = require(\"./AliasPlugin\");\r\nvar AliasFieldPlugin = require(\"./AliasFieldPlugin\");\r\nvar ConcordExtensionsPlugin = require(\"./ConcordExtensionsPlugin\");\r\nvar ConcordMainPlugin = require(\"./ConcordMainPlugin\");\r\nvar ConcordModulesPlugin = require(\"./ConcordModulesPlugin\");\r\nvar DirectoryExistsPlugin = require(\"./DirectoryExistsPlugin\");\r\nvar FileExistsPlugin = require(\"./FileExistsPlugin\");\r\nvar SymlinkPlugin = require(\"./SymlinkPlugin\");\r\nvar MainFieldPlugin = require(\"./MainFieldPlugin\");\r\nvar UseFilePlugin = require(\"./UseFilePlugin\");\r\nvar AppendPlugin = require(\"./AppendPlugin\");\r\nvar ResultPlugin = require(\"./ResultPlugin\");\r\nvar ModuleAppendPlugin = require(\"./ModuleAppendPlugin\");\r\nvar UnsafeCachePlugin = require(\"./UnsafeCachePlugin\");\r\n\r\nexports.createResolver = function(options) {\r\n\r\n\t//// OPTIONS ////\r\n\r\n\t// A list of directories to resolve modules from, can be absolute path or folder name\r\n\tvar modules = options.modules || [\"node_modules\"];\r\n\r\n\t// A list of description files to read from\r\n\tvar descriptionFiles = options.descriptionFiles || [\"package.json\"];\r\n\r\n\t// A list of additional resolve plugins which should be applied\r\n\t// The slice is there to create a copy, because otherwise pushing into plugins\r\n\t// changes the original options.plugins array, causing duplicate plugins\r\n\tvar plugins = (options.plugins && options.plugins.slice()) || [];\r\n\r\n\t// A list of main fields in description files\r\n\tvar mainFields = options.mainFields || [\"main\"];\r\n\r\n\t// A list of alias fields in description files\r\n\tvar aliasFields = options.aliasFields || [];\r\n\r\n\t// A list of main files in directories\r\n\tvar mainFiles = options.mainFiles || [\"index\"];\r\n\r\n\t// A list of extensions which should be tried for files\r\n\tvar extensions = options.extensions || [\".js\", \".json\", \".node\"];\r\n\r\n\t// Enforce that a extension from extensions must be used\r\n\tvar enforceExtension = options.enforceExtension || false;\r\n\r\n\t// A list of module extensions which should be tried for modules\r\n\tvar moduleExtensions = options.moduleExtensions || [];\r\n\r\n\t// Enforce that a extension from moduleExtensions must be used\r\n\tvar enforceModuleExtension = options.enforceModuleExtension || false;\r\n\r\n\t// A list of module alias configurations or an object which maps key to value\r\n\tvar alias = options.alias || [];\r\n\r\n\t// Resolve symlinks to their symlinked location\r\n\tvar symlinks = typeof options.symlinks !== \"undefined\" ? options.symlinks : true;\r\n\r\n\t// Resolve to a context instead of a file\r\n\tvar resolveToContext = options.resolveToContext || false;\r\n\r\n\t// Use this cache object to unsafely cache the successful requests\r\n\tvar unsafeCache = options.unsafeCache || false;\r\n\r\n\t// Whether or not the unsafeCache should include request context as part of the cache key.\r\n\tvar cacheWithContext = typeof options.cacheWithContext !== \"undefined\" ? options.cacheWithContext : true;\r\n\r\n\t// A function which decides whether a request should be cached or not.\r\n\t// an object is passed with `path` and `request` properties.\r\n\tvar cachePredicate = options.cachePredicate || function() {\r\n\t\treturn true;\r\n\t};\r\n\r\n\t// The file system which should be used\r\n\tvar fileSystem = options.fileSystem;\r\n\r\n\t// Use only the sync variants of the file system calls\r\n\tvar useSyncFileSystemCalls = options.useSyncFileSystemCalls;\r\n\r\n\t// A prepared Resolver to which the plugins are attached\r\n\tvar resolver = options.resolver;\r\n\r\n\t//// options processing ////\r\n\r\n\tif(!resolver) {\r\n\t\tresolver = new Resolver(useSyncFileSystemCalls ? new SyncAsyncFileSystemDecorator(fileSystem) : fileSystem);\r\n\t}\r\n\r\n\textensions = [].concat(extensions);\r\n\tmoduleExtensions = [].concat(moduleExtensions);\r\n\r\n\tmodules = mergeFilteredToArray([].concat(modules), function(item) {\r\n\t\treturn !isAbsolutePath(item);\r\n\t});\r\n\r\n\tmainFields = mainFields.map(function(item) {\r\n\t\tif(typeof item === \"string\") {\r\n\t\t\titem = {\r\n\t\t\t\tname: item,\r\n\t\t\t\tforceRelative: true\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn item;\r\n\t});\r\n\r\n\tif(typeof alias === \"object\" && !Array.isArray(alias)) {\r\n\t\talias = Object.keys(alias).map(function(key) {\r\n\t\t\tvar onlyModule = false;\r\n\t\t\tvar obj = alias[key];\r\n\t\t\tif(/\\$$/.test(key)) {\r\n\t\t\t\tonlyModule = true;\r\n\t\t\t\tkey = key.substr(0, key.length - 1);\r\n\t\t\t}\r\n\t\t\tif(typeof obj === \"string\") {\r\n\t\t\t\tobj = {\r\n\t\t\t\t\talias: obj\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tobj = Object.assign({\r\n\t\t\t\tname: key,\r\n\t\t\t\tonlyModule: onlyModule\r\n\t\t\t}, obj);\r\n\t\t\treturn obj;\r\n\t\t});\r\n\t}\r\n\r\n\tif(unsafeCache && typeof unsafeCache !== \"object\") {\r\n\t\tunsafeCache = {};\r\n\t}\r\n\r\n\t//// pipeline ////\r\n\r\n\t// resolve\r\n\tif(unsafeCache) {\r\n\t\tplugins.push(new UnsafeCachePlugin(\"resolve\", cachePredicate, unsafeCache, cacheWithContext, \"new-resolve\"));\r\n\t\tplugins.push(new ParsePlugin(\"new-resolve\", \"parsed-resolve\"));\r\n\t} else {\r\n\t\tplugins.push(new ParsePlugin(\"resolve\", \"parsed-resolve\"));\r\n\t}\r\n\r\n\t// parsed-resolve\r\n\tplugins.push(new DescriptionFilePlugin(\"parsed-resolve\", descriptionFiles, \"described-resolve\"));\r\n\tplugins.push(new NextPlugin(\"after-parsed-resolve\", \"described-resolve\"));\r\n\r\n\t// described-resolve\r\n\talias.forEach(function(item) {\r\n\t\tplugins.push(new AliasPlugin(\"described-resolve\", item, \"resolve\"));\r\n\t});\r\n\tplugins.push(new ConcordModulesPlugin(\"described-resolve\", {}, \"resolve\"));\r\n\taliasFields.forEach(function(item) {\r\n\t\tplugins.push(new AliasFieldPlugin(\"described-resolve\", item, \"resolve\"));\r\n\t});\r\n\tplugins.push(new ModuleKindPlugin(\"after-described-resolve\", \"raw-module\"));\r\n\tplugins.push(new JoinRequestPlugin(\"after-described-resolve\", \"relative\"));\r\n\r\n\t// raw-module\r\n\tmoduleExtensions.forEach(function(item) {\r\n\t\tplugins.push(new ModuleAppendPlugin(\"raw-module\", item, \"module\"));\r\n\t});\r\n\tif(!enforceModuleExtension)\r\n\t\tplugins.push(new TryNextPlugin(\"raw-module\", null, \"module\"));\r\n\r\n\t// module\r\n\tmodules.forEach(function(item) {\r\n\t\tif(Array.isArray(item))\r\n\t\t\tplugins.push(new ModulesInHierachicDirectoriesPlugin(\"module\", item, \"resolve\"));\r\n\t\telse\r\n\t\t\tplugins.push(new ModulesInRootPlugin(\"module\", item, \"resolve\"));\r\n\t});\r\n\r\n\t// relative\r\n\tplugins.push(new DescriptionFilePlugin(\"relative\", descriptionFiles, \"described-relative\"));\r\n\tplugins.push(new NextPlugin(\"after-relative\", \"described-relative\"));\r\n\r\n\t// described-relative\r\n\tplugins.push(new FileKindPlugin(\"described-relative\", \"raw-file\"));\r\n\tplugins.push(new TryNextPlugin(\"described-relative\", \"as directory\", \"directory\"));\r\n\r\n\t// directory\r\n\tplugins.push(new DirectoryExistsPlugin(\"directory\", \"existing-directory\"));\r\n\r\n\tif(resolveToContext) {\r\n\r\n\t\t// existing-directory\r\n\t\tplugins.push(new NextPlugin(\"existing-directory\", \"resolved\"));\r\n\r\n\t} else {\r\n\r\n\t\t// existing-directory\r\n\t\tplugins.push(new ConcordMainPlugin(\"existing-directory\", {}, \"resolve\"));\r\n\t\tmainFields.forEach(function(item) {\r\n\t\t\tplugins.push(new MainFieldPlugin(\"existing-directory\", item, \"resolve\"));\r\n\t\t});\r\n\t\tmainFiles.forEach(function(item) {\r\n\t\t\tplugins.push(new UseFilePlugin(\"existing-directory\", item, \"undescribed-raw-file\"));\r\n\t\t});\r\n\r\n\t\t// undescribed-raw-file\r\n\t\tplugins.push(new DescriptionFilePlugin(\"undescribed-raw-file\", descriptionFiles, \"raw-file\"));\r\n\t\tplugins.push(new NextPlugin(\"after-undescribed-raw-file\", \"raw-file\"));\r\n\r\n\t\t// raw-file\r\n\t\tif(!enforceExtension)\r\n\t\t\tplugins.push(new TryNextPlugin(\"raw-file\", \"no extension\", \"file\"));\r\n\t\tplugins.push(new ConcordExtensionsPlugin(\"raw-file\", {}, \"file\"));\r\n\t\textensions.forEach(function(item) {\r\n\t\t\tplugins.push(new AppendPlugin(\"raw-file\", item, \"file\"));\r\n\t\t});\r\n\r\n\t\t// file\r\n\t\talias.forEach(function(item) {\r\n\t\t\tplugins.push(new AliasPlugin(\"file\", item, \"resolve\"));\r\n\t\t});\r\n\t\tplugins.push(new ConcordModulesPlugin(\"file\", {}, \"resolve\"));\r\n\t\taliasFields.forEach(function(item) {\r\n\t\t\tplugins.push(new AliasFieldPlugin(\"file\", item, \"resolve\"));\r\n\t\t});\r\n\t\tif(symlinks)\r\n\t\t\tplugins.push(new SymlinkPlugin(\"file\", \"relative\"));\r\n\t\tplugins.push(new FileExistsPlugin(\"file\", \"existing-file\"));\r\n\r\n\t\t// existing-file\r\n\t\tplugins.push(new NextPlugin(\"existing-file\", \"resolved\"));\r\n\r\n\t}\r\n\r\n\t// resolved\r\n\tplugins.push(new ResultPlugin(\"resolved\"));\r\n\r\n\t//// RESOLVER ////\r\n\r\n\tplugins.forEach(function(plugin) {\r\n\t\tresolver.apply(plugin);\r\n\t});\r\n\treturn resolver;\r\n};\r\n\r\nfunction mergeFilteredToArray(array, filter) {\r\n\treturn array.reduce(function(array, item) {\r\n\t\tif(filter(item)) {\r\n\t\t\tvar lastElement = array[array.length - 1];\r\n\t\t\tif(Array.isArray(lastElement)) {\r\n\t\t\t\tlastElement.push(item);\r\n\t\t\t} else {\r\n\t\t\t\tarray.push([item]);\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t} else {\r\n\t\t\tarray.push(item);\r\n\t\t\treturn array;\r\n\t\t}\r\n\t}, []);\r\n}\r\n\r\nfunction isAbsolutePath(path) {\r\n\treturn /^[A-Z]:|^\\//.test(path);\r\n}\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Tapable = require(\"tapable\");\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction Resolver(fileSystem) {\r\n\tTapable.call(this);\r\n\tthis.fileSystem = fileSystem;\r\n}\r\nmodule.exports = Resolver;\r\n\r\nResolver.prototype = Object.create(Tapable.prototype);\r\n\r\nResolver.prototype.constructor = Resolver;\r\n\r\nResolver.prototype.resolveSync = function resolveSync(context, path, request) {\r\n\tvar err, result, sync = false;\r\n\tthis.resolve(context, path, request, function(e, r) {\r\n\t\terr = e;\r\n\t\tresult = r;\r\n\t\tsync = true;\r\n\t});\r\n\tif(!sync) throw new Error(\"Cannot 'resolveSync' because the fileSystem is not sync. Use 'resolve'!\");\r\n\tif(err) throw err;\r\n\treturn result;\r\n};\r\n\r\nResolver.prototype.resolve = function resolve(context, path, request, callback) {\r\n\tif(arguments.length === 3) {\r\n\t\tthrow new Error(\"Signature changed: context parameter added\");\r\n\t}\r\n\tvar resolver = this;\r\n\tvar obj = {\r\n\t\tcontext: context,\r\n\t\tpath: path,\r\n\t\trequest: request\r\n\t};\r\n\r\n\tvar localMissing;\r\n\tvar log;\r\n\tvar message = \"resolve '\" + request + \"' in '\" + path + \"'\";\r\n\r\n\tfunction writeLog(msg) {\r\n\t\tlog.push(msg);\r\n\t}\r\n\r\n\tfunction logAsString() {\r\n\t\treturn log.join(\"\\n\");\r\n\t}\r\n\r\n\tfunction onError(err, result) {\r\n\t\tif(callback.log) {\r\n\t\t\tfor(var i = 0; i < log.length; i++)\r\n\t\t\t\tcallback.log(log[i]);\r\n\t\t}\r\n\r\n\t\tif(err) return callback(err);\r\n\r\n\t\tvar error = new Error(\"Can't \" + message);\r\n\t\terror.details = logAsString();\r\n\t\terror.missing = localMissing;\r\n\t\tresolver.applyPlugins(\"no-resolve\", obj, error);\r\n\t\treturn callback(error);\r\n\t}\r\n\r\n\tfunction onResolve(err, result) {\r\n\t\tif(!err && result) {\r\n\t\t\treturn callback(null, result.path === false ? false : result.path + (result.query || \"\"), result);\r\n\t\t}\r\n\r\n\t\tlocalMissing = [];\r\n\t\tlog = [];\r\n\r\n\t\treturn resolver.doResolve(\"resolve\", obj, message, createInnerCallback(onError, {\r\n\t\t\tlog: writeLog,\r\n\t\t\tmissing: localMissing,\r\n\t\t\tstack: callback.stack\r\n\t\t}));\r\n\t}\r\n\r\n\tonResolve.missing = callback.missing;\r\n\tonResolve.stack = callback.stack;\r\n\r\n\treturn this.doResolve(\"resolve\", obj, message, onResolve);\r\n};\r\n\r\nResolver.prototype.doResolve = function doResolve(type, request, message, callback) {\r\n\tvar resolver = this;\r\n\tvar stackLine = type + \": (\" + request.path + \") \" +\r\n\t\t(request.request || \"\") + (request.query || \"\") +\r\n\t\t(request.directory ? \" directory\" : \"\") +\r\n\t\t(request.module ? \" module\" : \"\");\r\n\tvar newStack = [stackLine];\r\n\tif(callback.stack) {\r\n\t\tnewStack = callback.stack.concat(newStack);\r\n\t\tif(callback.stack.indexOf(stackLine) >= 0) {\r\n\t\t\t// Prevent recursion\r\n\t\t\tvar recursionError = new Error(\"Recursion in resolving\\nStack:\\n  \" + newStack.join(\"\\n  \"));\r\n\t\t\trecursionError.recursion = true;\r\n\t\t\tif(callback.log) callback.log(\"abort resolving because of recursion\");\r\n\t\t\treturn callback(recursionError);\r\n\t\t}\r\n\t}\r\n\tresolver.applyPlugins(\"resolve-step\", type, request);\r\n\r\n\tvar beforePluginName = \"before-\" + type;\r\n\tif(resolver.hasPlugins(beforePluginName)) {\r\n\t\tresolver.applyPluginsAsyncSeriesBailResult1(beforePluginName, request, createInnerCallback(beforeInnerCallback, {\r\n\t\t\tlog: callback.log,\r\n\t\t\tmissing: callback.missing,\r\n\t\t\tstack: newStack\r\n\t\t}, message && (\"before \" + message), true));\r\n\t} else {\r\n\t\trunNormal();\r\n\t}\r\n\r\n\tfunction beforeInnerCallback(err, result) {\r\n\t\tif(arguments.length > 0) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) return callback(null, result);\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\trunNormal();\r\n\t}\r\n\r\n\tfunction runNormal() {\r\n\t\tif(resolver.hasPlugins(type)) {\r\n\t\t\treturn resolver.applyPluginsAsyncSeriesBailResult1(type, request, createInnerCallback(innerCallback, {\r\n\t\t\t\tlog: callback.log,\r\n\t\t\t\tmissing: callback.missing,\r\n\t\t\t\tstack: newStack\r\n\t\t\t}, message));\r\n\t\t} else {\r\n\t\t\trunAfter();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction innerCallback(err, result) {\r\n\t\tif(arguments.length > 0) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) return callback(null, result);\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\trunAfter();\r\n\t}\r\n\r\n\tfunction runAfter() {\r\n\t\tvar afterPluginName = \"after-\" + type;\r\n\t\tif(resolver.hasPlugins(afterPluginName)) {\r\n\t\t\treturn resolver.applyPluginsAsyncSeriesBailResult1(afterPluginName, request, createInnerCallback(afterInnerCallback, {\r\n\t\t\t\tlog: callback.log,\r\n\t\t\t\tmissing: callback.missing,\r\n\t\t\t\tstack: newStack\r\n\t\t\t}, message && (\"after \" + message), true));\r\n\t\t} else {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction afterInnerCallback(err, result) {\r\n\t\tif(arguments.length > 0) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) return callback(null, result);\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\treturn callback();\r\n\t}\r\n};\r\n\r\nResolver.prototype.parse = function parse(identifier) {\r\n\tif(identifier === \"\") return null;\r\n\tvar part = {\r\n\t\trequest: \"\",\r\n\t\tquery: \"\",\r\n\t\tmodule: false,\r\n\t\tdirectory: false,\r\n\t\tfile: false\r\n\t};\r\n\tvar idxQuery = identifier.indexOf(\"?\");\r\n\tif(idxQuery === 0) {\r\n\t\tpart.query = identifier;\r\n\t} else if(idxQuery > 0) {\r\n\t\tpart.request = identifier.slice(0, idxQuery);\r\n\t\tpart.query = identifier.slice(idxQuery);\r\n\t} else {\r\n\t\tpart.request = identifier;\r\n\t}\r\n\tif(part.request) {\r\n\t\tpart.module = this.isModule(part.request);\r\n\t\tpart.directory = this.isDirectory(part.request);\r\n\t\tif(part.directory) {\r\n\t\t\tpart.request = part.request.substr(0, part.request.length - 1);\r\n\t\t}\r\n\t}\r\n\treturn part;\r\n};\r\n\r\nvar notModuleRegExp = /^\\.$|^\\.[\\\\\\/]|^\\.\\.$|^\\.\\.[\\/\\\\]|^\\/|^[A-Z]:[\\\\\\/]/i;\r\nResolver.prototype.isModule = function isModule(path) {\r\n\treturn !notModuleRegExp.test(path);\r\n};\r\n\r\nvar directoryRegExp = /[\\/\\\\]$/i;\r\nResolver.prototype.isDirectory = function isDirectory(path) {\r\n\treturn directoryRegExp.test(path);\r\n};\r\n\r\nvar memoryFsJoin = require(\"memory-fs/lib/join\");\r\nvar memoizedJoin = new Map();\r\nResolver.prototype.join = function(path, request) {\r\n\tvar cacheEntry;\r\n\tvar pathCache = memoizedJoin.get(path);\r\n\tif(typeof pathCache === \"undefined\") {\r\n\t\tmemoizedJoin.set(path, pathCache = new Map());\r\n\t} else {\r\n\t\tcacheEntry = pathCache.get(request);\r\n\t\tif(typeof cacheEntry !== \"undefined\")\r\n\t\t\treturn cacheEntry;\r\n\t}\r\n\tcacheEntry = memoryFsJoin(path, request);\r\n\tpathCache.set(request, cacheEntry);\r\n\treturn cacheEntry;\r\n};\r\n\r\nResolver.prototype.normalize = require(\"memory-fs/lib/normalize\");\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function createInnerCallback(callback, options, message, messageOptional) {\r\n\tvar log = options.log;\r\n\tif(!log) {\r\n\t\tif(options.stack !== callback.stack) {\r\n\t\t\tvar callbackWrapper = function callbackWrapper() {\r\n\t\t\t\treturn callback.apply(this, arguments);\r\n\t\t\t};\r\n\t\t\tcallbackWrapper.stack = options.stack;\r\n\t\t\tcallbackWrapper.missing = options.missing;\r\n\t\t\treturn callbackWrapper;\r\n\t\t}\r\n\t\treturn callback;\r\n\t}\r\n\r\n\tfunction loggingCallbackWrapper() {\r\n\t\tvar i;\r\n\t\tif(message) {\r\n\t\t\tif(!messageOptional || theLog.length > 0) {\r\n\t\t\t\tlog(message);\r\n\t\t\t\tfor(i = 0; i < theLog.length; i++)\r\n\t\t\t\t\tlog(\"  \" + theLog[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor(i = 0; i < theLog.length; i++)\r\n\t\t\t\tlog(theLog[i]);\r\n\t\t}\r\n\t\treturn callback.apply(this, arguments);\r\n\r\n\t}\r\n\tvar theLog = [];\r\n\tloggingCallbackWrapper.log = function writeLog(msg) {\r\n\t\ttheLog.push(msg);\r\n\t};\r\n\tloggingCallbackWrapper.stack = options.stack;\r\n\tloggingCallbackWrapper.missing = options.missing;\r\n\treturn loggingCallbackWrapper;\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction SyncAsyncFileSystemDecorator(fs) {\r\n\tthis.fs = fs;\r\n\tif(fs.statSync) {\r\n\t\tthis.stat = function(arg, callback) {\r\n\t\t\ttry {\r\n\t\t\t\tvar result = fs.statSync(arg);\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tcallback(null, result);\r\n\t\t};\r\n\t}\r\n\tif(fs.readdirSync) {\r\n\t\tthis.readdir = function(arg, callback) {\r\n\t\t\ttry {\r\n\t\t\t\tvar result = fs.readdirSync(arg);\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tcallback(null, result);\r\n\t\t};\r\n\t}\r\n\tif(fs.readFileSync) {\r\n\t\tthis.readFile = function(arg, callback) {\r\n\t\t\ttry {\r\n\t\t\t\tvar result = fs.readFileSync(arg);\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tcallback(null, result);\r\n\t\t};\r\n\t}\r\n\tif(fs.readlinkSync) {\r\n\t\tthis.readlink = function(arg, callback) {\r\n\t\t\ttry {\r\n\t\t\t\tvar result = fs.readlinkSync(arg);\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tcallback(null, result);\r\n\t\t};\r\n\t}\r\n\tif(fs.readJsonSync) {\r\n\t\tthis.readJson = function(arg, callback) {\r\n\t\t\ttry {\r\n\t\t\t\tvar result = fs.readJsonSync(arg);\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tcallback(null, result);\r\n\t\t};\r\n\t}\r\n}\r\nmodule.exports = SyncAsyncFileSystemDecorator;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction ParsePlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ParsePlugin;\r\n\r\nParsePlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar parsed = resolver.parse(request.request);\r\n\t\tvar obj = Object.assign({}, request, parsed);\r\n\t\tif(request.query && !parsed.query) {\r\n\t\t\tobj.query = request.query;\r\n\t\t}\r\n\t\tif(parsed && callback.log) {\r\n\t\t\tif(parsed.module)\r\n\t\t\t\tcallback.log(\"Parsed request is a module\");\r\n\t\t\tif(parsed.directory)\r\n\t\t\t\tcallback.log(\"Parsed request is a directory\");\r\n\t\t}\r\n\t\tresolver.doResolve(target, obj, null, callback);\r\n\t});\r\n};\r\n","\r\n/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nconst createInnerCallback = require(\"./createInnerCallback\");\r\nconst DescriptionFileUtils = require(\"./DescriptionFileUtils\");\r\n\r\nclass DescriptionFilePlugin {\r\n\tconstructor(source, filenames, target) {\r\n\t\tthis.source = source;\r\n\t\tthis.filenames = [].concat(filenames);\r\n\t\tthis.target = target;\r\n\t}\r\n\r\n\tapply(resolver) {\r\n\t\tconst filenames = this.filenames;\r\n\t\tconst target = this.target;\r\n\t\tresolver.plugin(this.source, (request, callback) => {\r\n\t\t\tconst directory = request.path;\r\n\t\t\tDescriptionFileUtils.loadDescriptionFile(resolver, directory, filenames, ((err, result) => {\r\n\t\t\t\tif(err) return callback(err);\r\n\t\t\t\tif(!result) {\r\n\t\t\t\t\tif(callback.missing) {\r\n\t\t\t\t\t\tfilenames.forEach((filename) => {\r\n\t\t\t\t\t\t\tcallback.missing.push(resolver.join(directory, filename));\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(callback.log) callback.log(\"No description file found\");\r\n\t\t\t\t\treturn callback();\r\n\t\t\t\t}\r\n\t\t\t\tconst relativePath = \".\" + request.path.substr(result.directory.length).replace(/\\\\/g, \"/\");\r\n\t\t\t\tconst obj = Object.assign({}, request, {\r\n\t\t\t\t\tdescriptionFilePath: result.path,\r\n\t\t\t\t\tdescriptionFileData: result.content,\r\n\t\t\t\t\tdescriptionFileRoot: result.directory,\r\n\t\t\t\t\trelativePath: relativePath\r\n\t\t\t\t});\r\n\t\t\t\tresolver.doResolve(target, obj, \"using description file: \" + result.path + \" (relative path: \" + relativePath + \")\", createInnerCallback((err, result) => {\r\n\t\t\t\t\tif(err) return callback(err);\r\n\t\t\t\t\tif(result) return callback(null, result);\r\n\r\n\t\t\t\t\t// Don't allow other description files or none at all\r\n\t\t\t\t\tcallback(null, null);\r\n\t\t\t\t}, callback));\r\n\t\t\t}));\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports = DescriptionFilePlugin;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar forEachBail = require(\"./forEachBail\");\r\n\r\nfunction loadDescriptionFile(resolver, directory, filenames, callback) {\r\n\t(function findDescriptionFile() {\r\n\t\tforEachBail(filenames, function(filename, callback) {\r\n\t\t\tvar descriptionFilePath = resolver.join(directory, filename);\r\n\t\t\tif(resolver.fileSystem.readJson) {\r\n\t\t\t\tresolver.fileSystem.readJson(descriptionFilePath, function(err, content) {\r\n\t\t\t\t\tif(err) {\r\n\t\t\t\t\t\tif(typeof err.code !== \"undefined\") return callback();\r\n\t\t\t\t\t\treturn onJson(err);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonJson(null, content);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tresolver.fileSystem.readFile(descriptionFilePath, function(err, content) {\r\n\t\t\t\t\tif(err) return callback();\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tvar json = JSON.parse(content);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tonJson(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonJson(null, json);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction onJson(err, content) {\r\n\t\t\t\tif(err) {\r\n\t\t\t\t\tif(callback.log)\r\n\t\t\t\t\t\tcallback.log(descriptionFilePath + \" (directory description file): \" + err);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\terr.message = descriptionFilePath + \" (directory description file): \" + err;\r\n\t\t\t\t\treturn callback(err);\r\n\t\t\t\t}\r\n\t\t\t\tcallback(null, {\r\n\t\t\t\t\tcontent: content,\r\n\t\t\t\t\tdirectory: directory,\r\n\t\t\t\t\tpath: descriptionFilePath\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}, function(err, result) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) {\r\n\t\t\t\treturn callback(null, result);\r\n\t\t\t} else {\r\n\t\t\t\tdirectory = cdUp(directory);\r\n\t\t\t\tif(!directory) {\r\n\t\t\t\t\treturn callback();\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn findDescriptionFile();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}());\r\n}\r\n\r\nfunction getField(content, field) {\r\n\tif(!content) return undefined;\r\n\tif(Array.isArray(field)) {\r\n\t\tvar current = content;\r\n\t\tfor(var j = 0; j < field.length; j++) {\r\n\t\t\tif(current === null || typeof current !== \"object\") {\r\n\t\t\t\tcurrent = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcurrent = current[field[j]];\r\n\t\t}\r\n\t\tif(typeof current === \"object\") {\r\n\t\t\treturn current;\r\n\t\t}\r\n\t} else {\r\n\t\tif(typeof content[field] === \"object\") {\r\n\t\t\treturn content[field];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction cdUp(directory) {\r\n\tif(directory === \"/\") return null;\r\n\tvar i = directory.lastIndexOf(\"/\"),\r\n\t\tj = directory.lastIndexOf(\"\\\\\");\r\n\tvar p = i < 0 ? j : j < 0 ? i : i < j ? j : i;\r\n\tif(p < 0) return null;\r\n\treturn directory.substr(0, p || 1);\r\n}\r\n\r\nexports.loadDescriptionFile = loadDescriptionFile;\r\nexports.getField = getField;\r\nexports.cdUp = cdUp;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function forEachBail(array, iterator, callback) {\r\n\tif(array.length === 0) return callback();\r\n\tvar currentPos = array.length;\r\n\tvar currentResult;\r\n\tvar done = [];\r\n\tfor(var i = 0; i < array.length; i++) {\r\n\t\tvar itCb = createIteratorCallback(i);\r\n\t\titerator(array[i], itCb);\r\n\t\tif(currentPos === 0) break;\r\n\t}\r\n\r\n\tfunction createIteratorCallback(i) {\r\n\t\treturn function() {\r\n\t\t\tif(i >= currentPos) return; // ignore\r\n\t\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\t\tdone.push(i);\r\n\t\t\tif(args.length > 0) {\r\n\t\t\t\tcurrentPos = i + 1;\r\n\t\t\t\tdone = done.filter(function(item) {\r\n\t\t\t\t\treturn item <= i;\r\n\t\t\t\t});\r\n\t\t\t\tcurrentResult = args;\r\n\t\t\t}\r\n\t\t\tif(done.length === currentPos) {\r\n\t\t\t\tcallback.apply(null, currentResult);\r\n\t\t\t\tcurrentPos = 0;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n};\r\n\r\nmodule.exports.withIndex = function forEachBailWithIndex(array, iterator, callback) {\r\n\tif(array.length === 0) return callback();\r\n\tvar currentPos = array.length;\r\n\tvar currentResult;\r\n\tvar done = [];\r\n\tfor(var i = 0; i < array.length; i++) {\r\n\t\tvar itCb = createIteratorCallback(i);\r\n\t\titerator(array[i], i, itCb);\r\n\t\tif(currentPos === 0) break;\r\n\t}\r\n\r\n\tfunction createIteratorCallback(i) {\r\n\t\treturn function() {\r\n\t\t\tif(i >= currentPos) return; // ignore\r\n\t\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\t\tdone.push(i);\r\n\t\t\tif(args.length > 0) {\r\n\t\t\t\tcurrentPos = i + 1;\r\n\t\t\t\tdone = done.filter(function(item) {\r\n\t\t\t\t\treturn item <= i;\r\n\t\t\t\t});\r\n\t\t\t\tcurrentResult = args;\r\n\t\t\t}\r\n\t\t\tif(done.length === currentPos) {\r\n\t\t\t\tcallback.apply(null, currentResult);\r\n\t\t\t\tcurrentPos = 0;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction NextPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = NextPlugin;\r\n\r\nNextPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tresolver.doResolve(target, request, null, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction TryNextPlugin(source, message, target) {\r\n\tthis.source = source;\r\n\tthis.message = message;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = TryNextPlugin;\r\n\r\nTryNextPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar message = this.message;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tresolver.doResolve(target, request, message, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction ModuleKindPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ModuleKindPlugin;\r\n\r\nModuleKindPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tif(!request.module) return callback();\r\n\t\tvar obj = Object.assign({}, request);\r\n\t\tdelete obj.module;\r\n\t\tresolver.doResolve(target, obj, \"resolve as module\", createInnerCallback(function(err, result) {\r\n\t\t\tif(arguments.length > 0) return callback(err, result);\r\n\r\n\t\t\t// Don't allow other alternatives\r\n\t\t\tcallback(null, null);\r\n\t\t}, callback));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction FileKindPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = FileKindPlugin;\r\n\r\nFileKindPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tif(request.directory) return callback();\r\n\t\tvar obj = Object.assign({}, request);\r\n\t\tdelete obj.directory;\r\n\t\tresolver.doResolve(target, obj, null, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction JoinRequestPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = JoinRequestPlugin;\r\n\r\nJoinRequestPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: resolver.join(request.path, request.request),\r\n\t\t\trelativePath: request.relativePath && resolver.join(request.relativePath, request.request),\r\n\t\t\trequest: undefined\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, null, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\nvar forEachBail = require(\"./forEachBail\");\r\nvar getPaths = require(\"./getPaths\");\r\n\r\nfunction ModulesInHierachicDirectoriesPlugin(source, directories, target) {\r\n\tthis.source = source;\r\n\tthis.directories = [].concat(directories);\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ModulesInHierachicDirectoriesPlugin;\r\n\r\nModulesInHierachicDirectoriesPlugin.prototype.apply = function(resolver) {\r\n\tvar directories = this.directories;\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar fs = this.fileSystem;\r\n\t\tvar topLevelCallback = callback;\r\n\t\tvar addrs = getPaths(request.path).paths.map(function(p) {\r\n\t\t\treturn directories.map(function(d) {\r\n\t\t\t\treturn this.join(p, d);\r\n\t\t\t}, this);\r\n\t\t}, this).reduce(function(array, p) {\r\n\t\t\tarray.push.apply(array, p);\r\n\t\t\treturn array;\r\n\t\t}, []);\r\n\t\tforEachBail(addrs, function(addr, callback) {\r\n\t\t\tfs.stat(addr, function(err, stat) {\r\n\t\t\t\tif(!err && stat && stat.isDirectory()) {\r\n\t\t\t\t\tvar obj = Object.assign({}, request, {\r\n\t\t\t\t\t\tpath: addr,\r\n\t\t\t\t\t\trequest: \"./\" + request.request\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar message = \"looking for modules in \" + addr;\r\n\t\t\t\t\treturn resolver.doResolve(target, obj, message, createInnerCallback(callback, topLevelCallback));\r\n\t\t\t\t}\r\n\t\t\t\tif(topLevelCallback.log) topLevelCallback.log(addr + \" doesn't exist or is not a directory\");\r\n\t\t\t\tif(topLevelCallback.missing) topLevelCallback.missing.push(addr);\r\n\t\t\t\treturn callback();\r\n\t\t\t});\r\n\t\t}, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function getPaths(path) {\r\n\tvar parts = path.split(/(.*?[\\\\\\/]+)/);\r\n\tvar paths = [path];\r\n\tvar seqments = [parts[parts.length - 1]];\r\n\tvar part = parts[parts.length - 1];\r\n\tpath = path.substr(0, path.length - part.length - 1);\r\n\tpaths.push(path);\r\n\tfor(var i = parts.length - 2; i > 2; i -= 2) {\r\n\t\tpart = parts[i];\r\n\t\tpath = path.substr(0, path.length - part.length) || \"/\";\r\n\t\tpaths.push(path);\r\n\t\tseqments.push(part.substr(0, part.length - 1));\r\n\t}\r\n\tpart = parts[1];\r\n\tseqments.push(part.length > 1 ? part.substr(0, part.length - 1) : part);\r\n\treturn {\r\n\t\tpaths: paths,\r\n\t\tseqments: seqments\r\n\t};\r\n};\r\n\r\nmodule.exports.basename = function basename(path) {\r\n\tvar i = path.lastIndexOf(\"/\"),\r\n\t\tj = path.lastIndexOf(\"\\\\\");\r\n\tvar p = i < 0 ? j : j < 0 ? i : i < j ? j : i;\r\n\tif(p < 0) return null;\r\n\tvar s = path.substr(p + 1);\r\n\treturn s;\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction ModulesInRootPlugin(source, path, target) {\r\n\tthis.source = source;\r\n\tthis.path = path;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ModulesInRootPlugin;\r\n\r\nModulesInRootPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar path = this.path;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: path,\r\n\t\t\trequest: \"./\" + request.request\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, \"looking for modules in \" + path, callback, true);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction startsWith(string, searchString) {\r\n\tvar stringLength = string.length;\r\n\tvar searchLength = searchString.length;\r\n\r\n\t// early out if the search length is greater than the search string\r\n\tif(searchLength > stringLength) {\r\n\t\treturn false;\r\n\t}\r\n\tvar index = -1;\r\n\twhile(++index < searchLength) {\r\n\t\tif(string.charCodeAt(index) !== searchString.charCodeAt(index)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction AliasPlugin(source, options, target) {\r\n\tthis.source = source;\r\n\tthis.name = options.name;\r\n\tthis.alias = options.alias;\r\n\tthis.onlyModule = options.onlyModule;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = AliasPlugin;\r\n\r\nAliasPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar name = this.name;\r\n\tvar alias = this.alias;\r\n\tvar onlyModule = this.onlyModule;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar innerRequest = request.request;\r\n\t\tif(!innerRequest) return callback();\r\n\t\tif(innerRequest === name || (!onlyModule && startsWith(innerRequest, name + \"/\"))) {\r\n\t\t\tif(innerRequest !== alias && !startsWith(innerRequest, alias + \"/\")) {\r\n\t\t\t\tvar newRequestStr = alias + innerRequest.substr(name.length);\r\n\t\t\t\tvar obj = Object.assign({}, request, {\r\n\t\t\t\t\trequest: newRequestStr\r\n\t\t\t\t});\r\n\t\t\t\treturn resolver.doResolve(target, obj, \"aliased with mapping '\" + name + \"': '\" + alias + \"' to '\" + newRequestStr + \"'\", createInnerCallback(function(err, result) {\r\n\t\t\t\t\tif(arguments.length > 0) return callback(err, result);\r\n\r\n\t\t\t\t\t// don't allow other aliasing or raw request\r\n\t\t\t\t\tcallback(null, null);\r\n\t\t\t\t}, callback));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn callback();\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\n\r\nvar DescriptionFileUtils = require(\"./DescriptionFileUtils\");\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\nvar getInnerRequest = require(\"./getInnerRequest\");\r\n\r\nfunction AliasFieldPlugin(source, field, target) {\r\n\tthis.source = source;\r\n\tthis.field = field;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = AliasFieldPlugin;\r\n\r\nAliasFieldPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar field = this.field;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tif(!request.descriptionFileData) return callback();\r\n\t\tvar innerRequest = getInnerRequest(resolver, request);\r\n\t\tif(!innerRequest) return callback();\r\n\t\tvar fieldData = DescriptionFileUtils.getField(request.descriptionFileData, field);\r\n\t\tif(typeof fieldData !== \"object\") {\r\n\t\t\tif(callback.log) callback.log(\"Field '\" + field + \"' doesn't contain a valid alias configuration\");\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\tvar data1 = fieldData[innerRequest];\r\n\t\tvar data2 = fieldData[innerRequest.replace(/^\\.\\//, \"\")];\r\n\t\tvar data = typeof data1 !== \"undefined\" ? data1 : data2;\r\n\t\tif(data === innerRequest) return callback();\r\n\t\tif(data === undefined) return callback();\r\n\t\tif(data === false) {\r\n\t\t\tvar ignoreObj = Object.assign({}, request, {\r\n\t\t\t\tpath: false\r\n\t\t\t});\r\n\t\t\treturn callback(null, ignoreObj);\r\n\t\t}\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: request.descriptionFileRoot,\r\n\t\t\trequest: data\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, \"aliased from description file \" + request.descriptionFilePath + \" with mapping '\" + innerRequest + \"' to '\" + data + \"'\", createInnerCallback(function(err, result) {\r\n\t\t\tif(arguments.length > 0) return callback(err, result);\r\n\r\n\t\t\t// Don't allow other aliasing or raw request\r\n\t\t\tcallback(null, null);\r\n\t\t}, callback));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function getInnerRequest(resolver, request) {\r\n\tif(typeof request.__innerRequest === \"string\" &&\r\n\t\trequest.__innerRequest_request === request.request &&\r\n\t\trequest.__innerRequest_relativePath === request.relativePath)\r\n\t\treturn request.__innerRequest;\r\n\tvar innerRequest;\r\n\tif(request.request) {\r\n\t\tinnerRequest = request.request;\r\n\t\tif(/^\\.\\.?\\//.test(innerRequest) && request.relativePath) {\r\n\t\t\tinnerRequest = resolver.join(request.relativePath, innerRequest);\r\n\t\t}\r\n\t} else {\r\n\t\tinnerRequest = request.relativePath;\r\n\t}\r\n\trequest.__innerRequest_request = request.request;\r\n\trequest.__innerRequest_relativePath = request.relativePath;\r\n\treturn request.__innerRequest = innerRequest;\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar concord = require(\"./concord\");\r\nvar DescriptionFileUtils = require(\"./DescriptionFileUtils\");\r\nvar forEachBail = require(\"./forEachBail\");\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction ConcordExtensionsPlugin(source, options, target) {\r\n\tthis.source = source;\r\n\tthis.options = options;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ConcordExtensionsPlugin;\r\n\r\nConcordExtensionsPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar concordField = DescriptionFileUtils.getField(request.descriptionFileData, \"concord\");\r\n\t\tif(!concordField) return callback();\r\n\t\tvar extensions = concord.getExtensions(request.context, concordField);\r\n\t\tif(!extensions) return callback();\r\n\t\tvar topLevelCallback = callback;\r\n\t\tforEachBail(extensions, function(appending, callback) {\r\n\t\t\tvar obj = Object.assign({}, request, {\r\n\t\t\t\tpath: request.path + appending,\r\n\t\t\t\trelativePath: request.relativePath && (request.relativePath + appending)\r\n\t\t\t});\r\n\t\t\tresolver.doResolve(target, obj, \"concord extension: \" + appending, createInnerCallback(callback, topLevelCallback));\r\n\t\t}, function(err, result) {\r\n\t\t\tif(arguments.length > 0) return callback(err, result);\r\n\r\n\t\t\tcallback(null, null);\r\n\t\t});\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar globToRegExp = require(\"./globToRegExp\").globToRegExp;\r\n\r\nfunction parseType(type) {\r\n\tvar items = type.split(\"+\");\r\n\tvar t = items.shift();\r\n\treturn {\r\n\t\ttype: t === \"*\" ? null : t,\r\n\t\tfeatures: items\r\n\t};\r\n}\r\n\r\nfunction isTypeMatched(baseType, testedType) {\r\n\tif(typeof baseType === \"string\") baseType = parseType(baseType);\r\n\tif(typeof testedType === \"string\") testedType = parseType(testedType);\r\n\tif(testedType.type && testedType.type !== baseType.type) return false;\r\n\treturn testedType.features.every(function(requiredFeature) {\r\n\t\treturn baseType.features.indexOf(requiredFeature) >= 0;\r\n\t});\r\n}\r\n\r\nfunction isResourceTypeMatched(baseType, testedType) {\r\n\tbaseType = baseType.split(\"/\");\r\n\ttestedType = testedType.split(\"/\");\r\n\tif(baseType.length !== testedType.length) return false;\r\n\tfor(var i = 0; i < baseType.length; i++) {\r\n\t\tif(!isTypeMatched(baseType[i], testedType[i]))\r\n\t\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction isResourceTypeSupported(context, type) {\r\n\treturn context.supportedResourceTypes && context.supportedResourceTypes.some(function(supportedType) {\r\n\t\treturn isResourceTypeMatched(supportedType, type);\r\n\t});\r\n}\r\n\r\nfunction isEnvironment(context, env) {\r\n\treturn context.environments && context.environments.every(function(environment) {\r\n\t\treturn isTypeMatched(environment, env);\r\n\t});\r\n}\r\n\r\nvar globCache = {};\r\n\r\nfunction getGlobRegExp(glob) {\r\n\tvar regExp = globCache[glob] || (globCache[glob] = globToRegExp(glob));\r\n\treturn regExp;\r\n}\r\n\r\nfunction matchGlob(glob, relativePath) {\r\n\tvar regExp = getGlobRegExp(glob);\r\n\treturn regExp.exec(relativePath);\r\n}\r\n\r\nfunction isGlobMatched(glob, relativePath) {\r\n\treturn !!matchGlob(glob, relativePath);\r\n}\r\n\r\nfunction isConditionMatched(context, condition) {\r\n\tvar items = condition.split(\"|\");\r\n\treturn items.some(function testFn(item) {\r\n\t\titem = item.trim();\r\n\t\tvar inverted = /^!/.test(item);\r\n\t\tif(inverted) return !testFn(item.substr(1));\r\n\t\tif(/^[a-z]+:/.test(item)) {\r\n\t\t\t// match named condition\r\n\t\t\tvar match = /^([a-z]+):\\s*/.exec(item);\r\n\t\t\tvar value = item.substr(match[0].length);\r\n\t\t\tvar name = match[1];\r\n\t\t\tswitch(name) {\r\n\t\t\t\tcase \"referrer\":\r\n\t\t\t\t\treturn isGlobMatched(value, context.referrer);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if(item.indexOf(\"/\") >= 0) {\r\n\t\t\t// match supported type\r\n\t\t\treturn isResourceTypeSupported(context, item);\r\n\t\t} else {\r\n\t\t\t// match environment\r\n\t\t\treturn isEnvironment(context, item);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction isKeyMatched(context, key) {\r\n\twhile(true) { //eslint-disable-line\r\n\t\tvar match = /^\\[([^\\]]+)\\]\\s*/.exec(key);\r\n\t\tif(!match) return key;\r\n\t\tkey = key.substr(match[0].length);\r\n\t\tvar condition = match[1];\r\n\t\tif(!isConditionMatched(context, condition)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getField(context, configuration, field) {\r\n\tvar value;\r\n\tObject.keys(configuration).forEach(function(key) {\r\n\t\tvar pureKey = isKeyMatched(context, key);\r\n\t\tif(pureKey === field) {\r\n\t\t\tvalue = configuration[key];\r\n\t\t}\r\n\t});\r\n\treturn value;\r\n}\r\n\r\nfunction getMain(context, configuration) {\r\n\treturn getField(context, configuration, \"main\");\r\n}\r\n\r\nfunction getExtensions(context, configuration) {\r\n\treturn getField(context, configuration, \"extensions\");\r\n}\r\n\r\nfunction matchModule(context, configuration, request) {\r\n\tvar modulesField = getField(context, configuration, \"modules\");\r\n\tif(!modulesField) return request;\r\n\tvar newRequest = request;\r\n\tvar keys = Object.keys(modulesField);\r\n\tvar iteration = 0;\r\n\tfor(var i = 0; i < keys.length; i++) {\r\n\t\tvar key = keys[i];\r\n\t\tvar pureKey = isKeyMatched(context, key);\r\n\t\tvar match = matchGlob(pureKey, newRequest);\r\n\t\tif(match) {\r\n\t\t\tvar value = modulesField[key];\r\n\t\t\tif(typeof value !== \"string\") {\r\n\t\t\t\treturn value;\r\n\t\t\t} else if(/^\\(.+\\)$/.test(pureKey)) {\r\n\t\t\t\tnewRequest = newRequest.replace(getGlobRegExp(pureKey), value);\r\n\t\t\t} else {\r\n\t\t\t\tvar index = 1;\r\n\t\t\t\tnewRequest = value.replace(/(\\/?\\*)?\\*/g, replaceMatcher);\r\n\t\t\t}\r\n\t\t\ti = -1;\r\n\t\t\tif(iteration++ > keys.length) {\r\n\t\t\t\tthrow new Error(\"Request '\" + request + \"' matches recursively\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn newRequest;\r\n\r\n\tfunction replaceMatcher(find) {\r\n\t\tswitch(find) {\r\n\t\t\tcase \"/**\":\r\n\t\t\t\tvar m = match[index++];\r\n\t\t\t\treturn m ? \"/\" + m : \"\";\r\n\t\t\tcase \"**\":\r\n\t\t\tcase \"*\":\r\n\t\t\t\treturn match[index++];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction matchType(context, configuration, relativePath) {\r\n\tvar typesField = getField(context, configuration, \"types\");\r\n\tif(!typesField) return undefined;\r\n\tvar type;\r\n\tObject.keys(typesField).forEach(function(key) {\r\n\t\tvar pureKey = isKeyMatched(context, key);\r\n\t\tif(isGlobMatched(pureKey, relativePath)) {\r\n\t\t\tvar value = typesField[key];\r\n\t\t\tif(!type && /\\/\\*$/.test(value))\r\n\t\t\t\tthrow new Error(\"value ('\" + value + \"') of key '\" + key + \"' contains '*', but there is no previous value defined\");\r\n\t\t\ttype = value.replace(/\\/\\*$/, \"/\" + type);\r\n\t\t}\r\n\t});\r\n\treturn type;\r\n}\r\n\r\nexports.parseType = parseType;\r\nexports.isTypeMatched = isTypeMatched;\r\nexports.isResourceTypeSupported = isResourceTypeSupported;\r\nexports.isEnvironment = isEnvironment;\r\nexports.isGlobMatched = isGlobMatched;\r\nexports.isConditionMatched = isConditionMatched;\r\nexports.isKeyMatched = isKeyMatched;\r\nexports.getField = getField;\r\nexports.getMain = getMain;\r\nexports.getExtensions = getExtensions;\r\nexports.matchModule = matchModule;\r\nexports.matchType = matchType;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction globToRegExp(glob) {\r\n\t// * [^\\\\\\/]*\r\n\t// /**/ /.+/\r\n\t// ^* \\./.+ (concord special)\r\n\t// ? [^\\\\\\/]\r\n\t// [!...] [^...]\r\n\t// [^...] [^...]\r\n\t// / [\\\\\\/]\r\n\t// {...,...} (...|...)\r\n\t// ?(...|...) (...|...)?\r\n\t// +(...|...) (...|...)+\r\n\t// *(...|...) (...|...)*\r\n\t// @(...|...) (...|...)\r\n\tif(/^\\(.+\\)$/.test(glob)) {\r\n\t\t// allow to pass an RegExp in brackets\r\n\t\treturn new RegExp(glob.substr(1, glob.length - 2));\r\n\t}\r\n\tvar tokens = tokenize(glob);\r\n\tvar process = createRoot();\r\n\tvar regExpStr = tokens.map(process).join(\"\");\r\n\treturn new RegExp(\"^\" + regExpStr + \"$\");\r\n}\r\n\r\nvar SIMPLE_TOKENS = {\r\n\t\"@(\": \"one\",\r\n\t\"?(\": \"zero-one\",\r\n\t\"+(\": \"one-many\",\r\n\t\"*(\": \"zero-many\",\r\n\t\"|\": \"segment-sep\",\r\n\t\"/**/\": \"any-path-segments\",\r\n\t\"**\": \"any-path\",\r\n\t\"*\": \"any-path-segment\",\r\n\t\"?\": \"any-char\",\r\n\t\"{\": \"or\",\r\n\t\"/\": \"path-sep\",\r\n\t\",\": \"comma\",\r\n\t\")\": \"closing-segment\",\r\n\t\"}\": \"closing-or\"\r\n};\r\n\r\nfunction tokenize(glob) {\r\n\treturn glob.split(/([@?+*]\\(|\\/\\*\\*\\/|\\*\\*|[?*]|\\[[\\!\\^]?(?:[^\\]\\\\]|\\\\.)+\\]|\\{|,|\\/|[|)}])/g).map(function(item) {\r\n\t\tif(!item)\r\n\t\t\treturn null;\r\n\t\tvar t = SIMPLE_TOKENS[item];\r\n\t\tif(t) {\r\n\t\t\treturn {\r\n\t\t\t\ttype: t\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(item[0] === \"[\") {\r\n\t\t\tif(item[1] === \"^\" || item[1] === \"!\") {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: \"inverted-char-set\",\r\n\t\t\t\t\tvalue: item.substr(2, item.length - 3)\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttype: \"char-set\",\r\n\t\t\t\t\tvalue: item.substr(1, item.length - 2)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: \"string\",\r\n\t\t\tvalue: item\r\n\t\t};\r\n\t}).filter(Boolean).concat({\r\n\t\ttype: \"end\"\r\n\t});\r\n}\r\n\r\nfunction createRoot() {\r\n\tvar inOr = [];\r\n\tvar process = createSeqment();\r\n\tvar initial = true;\r\n\treturn function(token) {\r\n\t\tswitch(token.type) {\r\n\t\t\tcase \"or\":\r\n\t\t\t\tinOr.push(initial);\r\n\t\t\t\treturn \"(\";\r\n\t\t\tcase \"comma\":\r\n\t\t\t\tif(inOr.length) {\r\n\t\t\t\t\tinitial = inOr[inOr.length - 1];\r\n\t\t\t\t\treturn \"|\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn process({\r\n\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\tvalue: \",\"\r\n\t\t\t\t\t}, initial);\r\n\t\t\t\t}\r\n\t\t\tcase \"closing-or\":\r\n\t\t\t\tif(inOr.length === 0)\r\n\t\t\t\t\tthrow new Error(\"Unmatched '}'\");\r\n\t\t\t\tinOr.pop();\r\n\t\t\t\treturn \")\";\r\n\t\t\tcase \"end\":\r\n\t\t\t\tif(inOr.length)\r\n\t\t\t\t\tthrow new Error(\"Unmatched '{'\");\r\n\t\t\t\treturn process(token, initial);\r\n\t\t\tdefault:\r\n\t\t\t\tvar result = process(token, initial);\r\n\t\t\t\tinitial = false;\r\n\t\t\t\treturn result;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction createSeqment() {\r\n\tvar inSeqment = [];\r\n\tvar process = createSimple();\r\n\treturn function(token, initial) {\r\n\t\tswitch(token.type) {\r\n\t\t\tcase \"one\":\r\n\t\t\tcase \"one-many\":\r\n\t\t\tcase \"zero-many\":\r\n\t\t\tcase \"zero-one\":\r\n\t\t\t\tinSeqment.push(token.type);\r\n\t\t\t\treturn \"(\";\r\n\t\t\tcase \"segment-sep\":\r\n\t\t\t\tif(inSeqment.length) {\r\n\t\t\t\t\treturn \"|\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn process({\r\n\t\t\t\t\t\ttype: \"string\",\r\n\t\t\t\t\t\tvalue: \"|\"\r\n\t\t\t\t\t}, initial);\r\n\t\t\t\t}\r\n\t\t\tcase \"closing-segment\":\r\n\t\t\t\tvar segment = inSeqment.pop();\r\n\t\t\t\tswitch(segment) {\r\n\t\t\t\t\tcase \"one\":\r\n\t\t\t\t\t\treturn \")\";\r\n\t\t\t\t\tcase \"one-many\":\r\n\t\t\t\t\t\treturn \")+\";\r\n\t\t\t\t\tcase \"zero-many\":\r\n\t\t\t\t\t\treturn \")*\";\r\n\t\t\t\t\tcase \"zero-one\":\r\n\t\t\t\t\t\treturn \")?\";\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error(\"Unexcepted segment \" + segment);\r\n\t\t\tcase \"end\":\r\n\t\t\t\tif(inSeqment.length > 0) {\r\n\t\t\t\t\tthrow new Error(\"Unmatched segment, missing ')'\");\r\n\t\t\t\t}\r\n\t\t\t\treturn process(token, initial);\r\n\t\t\tdefault:\r\n\t\t\t\treturn process(token, initial);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction createSimple() {\r\n\treturn function(token, initial) {\r\n\t\tswitch(token.type) {\r\n\t\t\tcase \"path-sep\":\r\n\t\t\t\treturn \"[\\\\\\\\/]+\";\r\n\t\t\tcase \"any-path-segments\":\r\n\t\t\t\treturn \"[\\\\\\\\/]+(?:(.+)[\\\\\\\\/]+)?\";\r\n\t\t\tcase \"any-path\":\r\n\t\t\t\treturn \"(.*)\";\r\n\t\t\tcase \"any-path-segment\":\r\n\t\t\t\tif(initial) {\r\n\t\t\t\t\treturn \"\\\\.[\\\\\\\\/]+(?:.*[\\\\\\\\/]+)?([^\\\\\\\\/]+)\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"([^\\\\\\\\/]*)\";\r\n\t\t\t\t}\r\n\t\t\tcase \"any-char\":\r\n\t\t\t\treturn \"[^\\\\\\\\/]\";\r\n\t\t\tcase \"inverted-char-set\":\r\n\t\t\t\treturn \"[^\" + token.value + \"]\";\r\n\t\t\tcase \"char-set\":\r\n\t\t\t\treturn \"[\" + token.value + \"]\";\r\n\t\t\tcase \"string\":\r\n\t\t\t\treturn token.value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\r\n\t\t\tcase \"end\":\r\n\t\t\t\treturn \"\";\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Unsupported token '\" + token.type + \"'\");\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexports.globToRegExp = globToRegExp;\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\nvar concord = require(\"./concord\");\r\nvar DescriptionFileUtils = require(\"./DescriptionFileUtils\");\r\n\r\nfunction ConcordMainPlugin(source, options, target) {\r\n\tthis.source = source;\r\n\tthis.options = options;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ConcordMainPlugin;\r\n\r\nConcordMainPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tif(request.path !== request.descriptionFileRoot) return callback();\r\n\t\tvar concordField = DescriptionFileUtils.getField(request.descriptionFileData, \"concord\");\r\n\t\tif(!concordField) return callback();\r\n\t\tvar mainModule = concord.getMain(request.context, concordField);\r\n\t\tif(!mainModule) return callback();\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\trequest: mainModule\r\n\t\t});\r\n\t\tvar filename = path.basename(request.descriptionFilePath);\r\n\t\treturn resolver.doResolve(target, obj, \"use \" + mainModule + \" from \" + filename, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar concord = require(\"./concord\");\r\nvar DescriptionFileUtils = require(\"./DescriptionFileUtils\");\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\nvar getInnerRequest = require(\"./getInnerRequest\");\r\n\r\nfunction ConcordModulesPlugin(source, options, target) {\r\n\tthis.source = source;\r\n\tthis.options = options;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ConcordModulesPlugin;\r\n\r\nConcordModulesPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar innerRequest = getInnerRequest(resolver, request);\r\n\t\tif(!innerRequest) return callback();\r\n\t\tvar concordField = DescriptionFileUtils.getField(request.descriptionFileData, \"concord\");\r\n\t\tif(!concordField) return callback();\r\n\t\tvar data = concord.matchModule(request.context, concordField, innerRequest);\r\n\t\tif(data === innerRequest) return callback();\r\n\t\tif(data === undefined) return callback();\r\n\t\tif(data === false) {\r\n\t\t\tvar ignoreObj = Object.assign({}, request, {\r\n\t\t\t\tpath: false\r\n\t\t\t});\r\n\t\t\treturn callback(null, ignoreObj);\r\n\t\t}\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: request.descriptionFileRoot,\r\n\t\t\trequest: data\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, \"aliased from description file \" + request.descriptionFilePath + \" with mapping '\" + innerRequest + \"' to '\" + data + \"'\", createInnerCallback(function(err, result) {\r\n\t\t\tif(arguments.length > 0) return callback(err, result);\r\n\r\n\t\t\t// Don't allow other aliasing or raw request\r\n\t\t\tcallback(null, null);\r\n\t\t}, callback));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction DirectoryExistsPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = DirectoryExistsPlugin;\r\n\r\nDirectoryExistsPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar fs = this.fileSystem;\r\n\t\tvar directory = request.path;\r\n\t\tfs.stat(directory, function(err, stat) {\r\n\t\t\tif(err || !stat) {\r\n\t\t\t\tif(callback.missing) callback.missing.push(directory);\r\n\t\t\t\tif(callback.log) callback.log(directory + \" doesn't exist\");\r\n\t\t\t\treturn callback();\r\n\t\t\t}\r\n\t\t\tif(!stat.isDirectory()) {\r\n\t\t\t\tif(callback.missing) callback.missing.push(directory);\r\n\t\t\t\tif(callback.log) callback.log(directory + \" is not a directory\");\r\n\t\t\t\treturn callback();\r\n\t\t\t}\r\n\t\t\tthis.doResolve(target, request, \"existing directory\", callback);\r\n\t\t}.bind(this));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction FileExistsPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = FileExistsPlugin;\r\n\r\nFileExistsPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar fs = this.fileSystem;\r\n\t\tvar file = request.path;\r\n\t\tfs.stat(file, function(err, stat) {\r\n\t\t\tif(err || !stat) {\r\n\t\t\t\tif(callback.missing) callback.missing.push(file);\r\n\t\t\t\tif(callback.log) callback.log(file + \" doesn't exist\");\r\n\t\t\t\treturn callback();\r\n\t\t\t}\r\n\t\t\tif(!stat.isFile()) {\r\n\t\t\t\tif(callback.missing) callback.missing.push(file);\r\n\t\t\t\tif(callback.log) callback.log(file + \" is not a file\");\r\n\t\t\t\treturn callback();\r\n\t\t\t}\r\n\t\t\tthis.doResolve(target, request, \"existing file: \" + file, callback, true);\r\n\t\t}.bind(this));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar getPaths = require(\"./getPaths\");\r\nvar forEachBail = require(\"./forEachBail\");\r\n\r\nfunction SymlinkPlugin(source, target) {\r\n\tthis.source = source;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = SymlinkPlugin;\r\n\r\nSymlinkPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar _this = this;\r\n\t\tvar fs = _this.fileSystem;\r\n\t\tvar pathsResult = getPaths(request.path);\r\n\t\tvar pathSeqments = pathsResult.seqments;\r\n\t\tvar paths = pathsResult.paths;\r\n\r\n\t\tvar containsSymlink = false;\r\n\t\tforEachBail.withIndex(paths, function(path, idx, callback) {\r\n\t\t\tfs.readlink(path, function(err, result) {\r\n\t\t\t\tif(!err && result) {\r\n\t\t\t\t\tpathSeqments[idx] = result;\r\n\t\t\t\t\tcontainsSymlink = true;\r\n\t\t\t\t\t// Shortcut when absolute symlink found\r\n\t\t\t\t\tif(/^(\\/|[a-zA-z]:($|\\\\))/.test(result))\r\n\t\t\t\t\t\treturn callback(null, idx);\r\n\t\t\t\t}\r\n\t\t\t\tcallback();\r\n\t\t\t});\r\n\t\t}, function(err, idx) {\r\n\t\t\tif(!containsSymlink) return callback();\r\n\t\t\tvar resultSeqments = typeof idx === \"number\" ? pathSeqments.slice(0, idx + 1) : pathSeqments.slice();\r\n\t\t\tvar result = resultSeqments.reverse().reduce(function(a, b) {\r\n\t\t\t\treturn _this.join(a, b);\r\n\t\t\t});\r\n\t\t\tvar obj = Object.assign({}, request, {\r\n\t\t\t\tpath: result\r\n\t\t\t});\r\n\t\t\tresolver.doResolve(target, obj, \"resolved symlink to \" + result, callback);\r\n\t\t});\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\n\r\nfunction MainFieldPlugin(source, options, target) {\r\n\tthis.source = source;\r\n\tthis.options = options;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = MainFieldPlugin;\r\n\r\nMainFieldPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar options = this.options;\r\n\tresolver.plugin(this.source, function mainField(request, callback) {\r\n\t\tif(request.path !== request.descriptionFileRoot) return callback();\r\n\t\tvar content = request.descriptionFileData;\r\n\t\tvar filename = path.basename(request.descriptionFilePath);\r\n\t\tvar mainModule;\r\n\t\tvar field = options.name;\r\n\t\tif(Array.isArray(field)) {\r\n\t\t\tvar current = content;\r\n\t\t\tfor(var j = 0; j < field.length; j++) {\r\n\t\t\t\tif(current === null || typeof current !== \"object\") {\r\n\t\t\t\t\tcurrent = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcurrent = current[field[j]];\r\n\t\t\t}\r\n\t\t\tif(typeof current === \"string\") {\r\n\t\t\t\tmainModule = current;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(typeof content[field] === \"string\") {\r\n\t\t\t\tmainModule = content[field];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!mainModule) return callback();\r\n\t\tif(options.forceRelative && !/^\\.\\.?\\//.test(mainModule))\r\n\t\t\tmainModule = \"./\" + mainModule;\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\trequest: mainModule\r\n\t\t});\r\n\t\treturn resolver.doResolve(target, obj, \"use \" + mainModule + \" from \" + options.name + \" in \" + filename, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction UseFilePlugin(source, filename, target) {\r\n\tthis.source = source;\r\n\tthis.filename = filename;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = UseFilePlugin;\r\n\r\nUseFilePlugin.prototype.apply = function(resolver) {\r\n\tvar filename = this.filename;\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar filePath = resolver.join(request.path, filename);\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: filePath,\r\n\t\t\trelativePath: request.relativePath && resolver.join(request.relativePath, filename)\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, \"using path: \" + filePath, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction AppendPlugin(source, appending, target) {\r\n\tthis.source = source;\r\n\tthis.appending = appending;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = AppendPlugin;\r\n\r\nAppendPlugin.prototype.apply = function(resolver) {\r\n\tvar target = this.target;\r\n\tvar appending = this.appending;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\tpath: request.path + appending,\r\n\t\t\trelativePath: request.relativePath && (request.relativePath + appending)\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, appending, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction ResultPlugin(source) {\r\n\tthis.source = source;\r\n}\r\nmodule.exports = ResultPlugin;\r\n\r\nResultPlugin.prototype.apply = function(resolver) {\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar obj = Object.assign({}, request);\r\n\t\tresolver.applyPluginsAsyncSeries1(\"result\", obj, function(err) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tcallback(null, obj);\r\n\t\t});\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction ModuleAppendPlugin(source, appending, target) {\r\n\tthis.source = source;\r\n\tthis.appending = appending;\r\n\tthis.target = target;\r\n}\r\nmodule.exports = ModuleAppendPlugin;\r\n\r\nModuleAppendPlugin.prototype.apply = function(resolver) {\r\n\tvar appending = this.appending;\r\n\tvar target = this.target;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tvar i = request.request.indexOf(\"/\"),\r\n\t\t\tj = request.request.indexOf(\"\\\\\");\r\n\t\tvar p = i < 0 ? j : j < 0 ? i : i < j ? i : j;\r\n\t\tvar moduleName, remainingRequest;\r\n\t\tif(p < 0) {\r\n\t\t\tmoduleName = request.request;\r\n\t\t\tremainingRequest = \"\";\r\n\t\t} else {\r\n\t\t\tmoduleName = request.request.substr(0, p);\r\n\t\t\tremainingRequest = request.request.substr(p);\r\n\t\t}\r\n\t\tif(moduleName === \".\" || moduleName === \"..\")\r\n\t\t\treturn callback();\r\n\t\tvar moduleFinalName = moduleName + appending;\r\n\t\tvar obj = Object.assign({}, request, {\r\n\t\t\trequest: moduleFinalName + remainingRequest\r\n\t\t});\r\n\t\tresolver.doResolve(target, obj, \"module variation \" + moduleFinalName, callback);\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction UnsafeCachePlugin(source, filterPredicate, cache, withContext, target) {\r\n\tthis.source = source;\r\n\tthis.filterPredicate = filterPredicate;\r\n\tthis.withContext = withContext;\r\n\tthis.cache = cache || {};\r\n\tthis.target = target;\r\n}\r\nmodule.exports = UnsafeCachePlugin;\r\n\r\nfunction getCacheId(request, withContext) {\r\n\treturn JSON.stringify({\r\n\t\tcontext: withContext ? request.context : \"\",\r\n\t\tpath: request.path,\r\n\t\tquery: request.query,\r\n\t\trequest: request.request\r\n\t});\r\n}\r\n\r\nUnsafeCachePlugin.prototype.apply = function(resolver) {\r\n\tvar filterPredicate = this.filterPredicate;\r\n\tvar cache = this.cache;\r\n\tvar target = this.target;\r\n\tvar withContext = this.withContext;\r\n\tresolver.plugin(this.source, function(request, callback) {\r\n\t\tif(!filterPredicate(request)) return callback();\r\n\t\tvar cacheId = getCacheId(request, withContext);\r\n\t\tvar cacheEntry = cache[cacheId];\r\n\t\tif(cacheEntry) {\r\n\t\t\treturn callback(null, cacheEntry);\r\n\t\t}\r\n\t\tresolver.doResolve(target, request, null, createInnerCallback(function(err, result) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) return callback(null, cache[cacheId] = result);\r\n\t\t\tcallback();\r\n\t\t}, callback));\r\n\t});\r\n};\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar fs = require(\"graceful-fs\");\r\n\r\nfunction NodeJsInputFileSystem() {}\r\nmodule.exports = NodeJsInputFileSystem;\r\n\r\nNodeJsInputFileSystem.prototype.stat = fs.stat.bind(fs);\r\nNodeJsInputFileSystem.prototype.readdir = function readdir(path, callback) {\r\n\tfs.readdir(path, function(err, files) {\r\n\t\tcallback(err, files && files.map(function(file) {\r\n\t\t\treturn file.normalize ? file.normalize(\"NFC\") : file;\r\n\t\t}));\r\n\t});\r\n};\r\nNodeJsInputFileSystem.prototype.readFile = fs.readFile.bind(fs);\r\nNodeJsInputFileSystem.prototype.readlink = fs.readlink.bind(fs);\r\n\r\nNodeJsInputFileSystem.prototype.statSync = fs.statSync.bind(fs);\r\nNodeJsInputFileSystem.prototype.readdirSync = function readdirSync(path) {\r\n\tvar files = fs.readdirSync(path);\r\n\treturn files && files.map(function(file) {\r\n\t\treturn file.normalize ? file.normalize(\"NFC\") : file;\r\n\t});\r\n};\r\nNodeJsInputFileSystem.prototype.readFileSync = fs.readFileSync.bind(fs);\r\nNodeJsInputFileSystem.prototype.readlinkSync = fs.readlinkSync.bind(fs);\r\n","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nfunction Storage(duration) {\r\n\tthis.duration = duration;\r\n\tthis.running = new Map();\r\n\tthis.data = new Map();\r\n\tthis.levels = [];\r\n\tif(duration > 0) {\r\n\t\tthis.levels.push(new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set(), new Set());\r\n\t\tfor(var i = 8000; i < duration; i += 500)\r\n\t\t\tthis.levels.push(new Set());\r\n\t}\r\n\tthis.count = 0;\r\n\tthis.interval = null;\r\n\tthis.needTickCheck = false;\r\n\tthis.nextTick = null;\r\n\tthis.passive = true;\r\n\tthis.tick = this.tick.bind(this);\r\n}\r\n\r\nStorage.prototype.ensureTick = function() {\r\n\tif(!this.interval && this.duration > 0 && !this.nextTick)\r\n\t\tthis.interval = setInterval(this.tick, Math.floor(this.duration / this.levels.length));\r\n};\r\n\r\nStorage.prototype.finished = function(name, err, result) {\r\n\tvar callbacks = this.running.get(name);\r\n\tthis.running.delete(name);\r\n\tif(this.duration > 0) {\r\n\t\tthis.data.set(name, [err, result]);\r\n\t\tvar levelData = this.levels[0];\r\n\t\tthis.count -= levelData.size;\r\n\t\tlevelData.add(name);\r\n\t\tthis.count += levelData.size;\r\n\t\tthis.ensureTick();\r\n\t}\r\n\tfor(var i = 0; i < callbacks.length; i++) {\r\n\t\tcallbacks[i](err, result);\r\n\t}\r\n};\r\n\r\nStorage.prototype.finishedSync = function(name, err, result) {\r\n\tif(this.duration > 0) {\r\n\t\tthis.data.set(name, [err, result]);\r\n\t\tvar levelData = this.levels[0];\r\n\t\tthis.count -= levelData.size;\r\n\t\tlevelData.add(name);\r\n\t\tthis.count += levelData.size;\r\n\t\tthis.ensureTick();\r\n\t}\r\n};\r\n\r\nStorage.prototype.provide = function(name, provider, callback) {\r\n\tif(typeof name !== \"string\") {\r\n\t\tcallback(new TypeError(\"path must be a string\"));\r\n\t\treturn;\r\n\t}\r\n\tvar running = this.running.get(name);\r\n\tif(running) {\r\n\t\trunning.push(callback);\r\n\t\treturn;\r\n\t}\r\n\tif(this.duration > 0) {\r\n\t\tthis.checkTicks();\r\n\t\tvar data = this.data.get(name);\r\n\t\tif(data) {\r\n\t\t\treturn process.nextTick(function() {\r\n\t\t\t\tcallback.apply(null, data);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tthis.running.set(name, running = [callback]);\r\n\tvar _this = this;\r\n\tprovider(name, function(err, result) {\r\n\t\t_this.finished(name, err, result);\r\n\t});\r\n};\r\n\r\nStorage.prototype.provideSync = function(name, provider) {\r\n\tif(typeof name !== \"string\") {\r\n\t\tthrow new TypeError(\"path must be a string\");\r\n\t}\r\n\tif(this.duration > 0) {\r\n\t\tthis.checkTicks();\r\n\t\tvar data = this.data.get(name);\r\n\t\tif(data) {\r\n\t\t\tif(data[0])\r\n\t\t\t\tthrow data[0];\r\n\t\t\treturn data[1];\r\n\t\t}\r\n\t}\r\n\ttry {\r\n\t\tvar result = provider(name);\r\n\t} catch(e) {\r\n\t\tthis.finishedSync(name, e);\r\n\t\tthrow e;\r\n\t}\r\n\tthis.finishedSync(name, null, result);\r\n\treturn result;\r\n};\r\n\r\nStorage.prototype.tick = function() {\r\n\tvar decay = this.levels.pop();\r\n\tfor(var item of decay) {\r\n\t\tthis.data.delete(item);\r\n\t}\r\n\tthis.count -= decay.size;\r\n\tdecay.clear();\r\n\tthis.levels.unshift(decay);\r\n\tif(this.count === 0) {\r\n\t\tclearInterval(this.interval);\r\n\t\tthis.interval = null;\r\n\t\tthis.nextTick = null;\r\n\t\treturn true;\r\n\t} else if(this.nextTick) {\r\n\t\tthis.nextTick += Math.floor(this.duration / this.levels.length);\r\n\t\tvar time = new Date().getTime();\r\n\t\tif(this.nextTick > time) {\r\n\t\t\tthis.nextTick = null;\r\n\t\t\tthis.interval = setInterval(this.tick, Math.floor(this.duration / this.levels.length));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else if(this.passive) {\r\n\t\tclearInterval(this.interval);\r\n\t\tthis.interval = null;\r\n\t\tthis.nextTick = new Date().getTime() + Math.floor(this.duration / this.levels.length);\r\n\t} else {\r\n\t\tthis.passive = true;\r\n\t}\r\n};\r\n\r\nStorage.prototype.checkTicks = function() {\r\n\tthis.passive = false;\r\n\tif(this.nextTick) {\r\n\t\twhile(!this.tick());\r\n\t}\r\n};\r\n\r\nStorage.prototype.purge = function(what) {\r\n\tif(!what) {\r\n\t\tthis.count = 0;\r\n\t\tclearInterval(this.interval);\r\n\t\tthis.nextTick = null;\r\n\t\tthis.data.clear();\r\n\t\tthis.levels.forEach(function(level) {\r\n\t\t\tlevel.clear();\r\n\t\t});\r\n\t} else if(typeof what === \"string\") {\r\n\t\tfor(var key of this.data.keys()) {\r\n\t\t\tif(key.startsWith(what))\r\n\t\t\t\tthis.data.delete(key);\r\n\t\t}\r\n\t} else {\r\n\t\tfor(var i = what.length - 1; i >= 0; i--) {\r\n\t\t\tthis.purge(what[i]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction CachedInputFileSystem(fileSystem, duration) {\r\n\tthis.fileSystem = fileSystem;\r\n\tthis._statStorage = new Storage(duration);\r\n\tthis._readdirStorage = new Storage(duration);\r\n\tthis._readFileStorage = new Storage(duration);\r\n\tthis._readJsonStorage = new Storage(duration);\r\n\tthis._readlinkStorage = new Storage(duration);\r\n\r\n\tthis._stat = this.fileSystem.stat ? this.fileSystem.stat.bind(this.fileSystem) : null;\r\n\tif(!this._stat) this.stat = null;\r\n\r\n\tthis._statSync = this.fileSystem.statSync ? this.fileSystem.statSync.bind(this.fileSystem) : null;\r\n\tif(!this._statSync) this.statSync = null;\r\n\r\n\tthis._readdir = this.fileSystem.readdir ? this.fileSystem.readdir.bind(this.fileSystem) : null;\r\n\tif(!this._readdir) this.readdir = null;\r\n\r\n\tthis._readdirSync = this.fileSystem.readdirSync ? this.fileSystem.readdirSync.bind(this.fileSystem) : null;\r\n\tif(!this._readdirSync) this.readdirSync = null;\r\n\r\n\tthis._readFile = this.fileSystem.readFile ? this.fileSystem.readFile.bind(this.fileSystem) : null;\r\n\tif(!this._readFile) this.readFile = null;\r\n\r\n\tthis._readFileSync = this.fileSystem.readFileSync ? this.fileSystem.readFileSync.bind(this.fileSystem) : null;\r\n\tif(!this._readFileSync) this.readFileSync = null;\r\n\r\n\tif(this.fileSystem.readJson) {\r\n\t\tthis._readJson = this.fileSystem.readJson.bind(this.fileSystem);\r\n\t} else if(this.readFile) {\r\n\t\tthis._readJson = function(path, callback) {\r\n\t\t\tthis.readFile(path, function(err, buffer) {\r\n\t\t\t\tif(err) return callback(err);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar data = JSON.parse(buffer.toString(\"utf-8\"));\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\treturn callback(e);\r\n\t\t\t\t}\r\n\t\t\t\tcallback(null, data);\r\n\t\t\t});\r\n\t\t}.bind(this);\r\n\t} else {\r\n\t\tthis.readJson = null;\r\n\t}\r\n\tif(this.fileSystem.readJsonSync) {\r\n\t\tthis._readJsonSync = this.fileSystem.readJsonSync.bind(this.fileSystem);\r\n\t} else if(this.readFileSync) {\r\n\t\tthis._readJsonSync = function(path) {\r\n\t\t\tvar buffer = this.readFileSync(path);\r\n\t\t\tvar data = JSON.parse(buffer.toString(\"utf-8\"));\r\n\t\t\treturn data;\r\n\t\t}.bind(this);\r\n\t} else {\r\n\t\tthis.readJsonSync = null;\r\n\t}\r\n\r\n\tthis._readlink = this.fileSystem.readlink ? this.fileSystem.readlink.bind(this.fileSystem) : null;\r\n\tif(!this._readlink) this.readlink = null;\r\n\r\n\tthis._readlinkSync = this.fileSystem.readlinkSync ? this.fileSystem.readlinkSync.bind(this.fileSystem) : null;\r\n\tif(!this._readlinkSync) this.readlinkSync = null;\r\n}\r\nmodule.exports = CachedInputFileSystem;\r\n\r\nCachedInputFileSystem.prototype.stat = function(path, callback) {\r\n\tthis._statStorage.provide(path, this._stat, callback);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readdir = function(path, callback) {\r\n\tthis._readdirStorage.provide(path, this._readdir, callback);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readFile = function(path, callback) {\r\n\tthis._readFileStorage.provide(path, this._readFile, callback);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readJson = function(path, callback) {\r\n\tthis._readJsonStorage.provide(path, this._readJson, callback);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readlink = function(path, callback) {\r\n\tthis._readlinkStorage.provide(path, this._readlink, callback);\r\n};\r\n\r\nCachedInputFileSystem.prototype.statSync = function(path) {\r\n\treturn this._statStorage.provideSync(path, this._statSync);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readdirSync = function(path) {\r\n\treturn this._readdirStorage.provideSync(path, this._readdirSync);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readFileSync = function(path) {\r\n\treturn this._readFileStorage.provideSync(path, this._readFileSync);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readJsonSync = function(path) {\r\n\treturn this._readJsonStorage.provideSync(path, this._readJsonSync);\r\n};\r\n\r\nCachedInputFileSystem.prototype.readlinkSync = function(path) {\r\n\treturn this._readlinkStorage.provideSync(path, this._readlinkSync);\r\n};\r\n\r\nCachedInputFileSystem.prototype.purge = function(what) {\r\n\tthis._statStorage.purge(what);\r\n\tthis._readdirStorage.purge(what);\r\n\tthis._readFileStorage.purge(what);\r\n\tthis._readlinkStorage.purge(what);\r\n\tthis._readJsonStorage.purge(what);\r\n};\r\n"]}